<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>🎵 Air Conductor - Virtual Orchestra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap');
    
    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }
    
    :root {
      /* Professional Color Palette */
      --primary: #0066FF;
      --primary-light: #3385FF;
      --primary-dark: #0052CC;
      --secondary: #6366F1;
      --accent: #10B981;
      --warning: #F59E0B;
      --error: #EF4444;
      
      /* Neutral Colors */
      --gray-50: #F9FAFB;
      --gray-100: #F3F4F6;
      --gray-200: #E5E7EB;
      --gray-300: #D1D5DB;
      --gray-400: #9CA3AF;
      --gray-500: #6B7280;
      --gray-600: #4B5563;
      --gray-700: #374151;
      --gray-800: #1F2937;
      --gray-900: #111827;
      
      /* Background */
      --bg-primary: #0A0E1A;
      --bg-secondary: #131B2E;
      --bg-card: rgba(255, 255, 255, 0.08);
      --bg-card-hover: rgba(255, 255, 255, 0.12);
      
      /* Text */
      --text-primary: #FFFFFF;
      --text-secondary: #CBD5E1;
      --text-tertiary: #94A3B8;
      
      /* Borders & Shadows */
      --border-primary: rgba(255, 255, 255, 0.1);
      --border-secondary: rgba(255, 255, 255, 0.05);
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      
      /* Glassmorphism */
      --glass-bg: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      
      /* Transitions */
      --transition-fast: 150ms ease-out;
      --transition: 250ms ease-out;
      --transition-slow: 350ms ease-out;
      
      /* Border Radius */
      --radius-sm: 4px;
      --radius: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      --radius-2xl: 24px;
    }
    
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
      background: var(--bg-primary);
      overflow: hidden;
      color: var(--text-primary);
      font-feature-settings: 'liga' 1, 'kern' 1;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      line-height: 1.5;
    }
    
    #app { 
      position: relative; 
      width: 100vw; 
      height: 100vh; 
      display: flex;
      align-items: center;
      justify-content: center;
      background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.1) 0%, transparent 50%),
        var(--bg-primary);
    }
    
    /* Cosmic starfield background */
    .cosmic-starfield {
      position: absolute;
      inset: 0;
      z-index: 0;
      background: 
        radial-gradient(2px 2px at 20px 30px, #FFFFFF, transparent),
        radial-gradient(2px 2px at 40px 70px, #4A90E2, transparent),
        radial-gradient(1px 1px at 90px 40px, #F5A623, transparent),
        radial-gradient(1px 1px at 130px 80px, #FFFFFF, transparent),
        radial-gradient(2px 2px at 160px 30px, #9013FE, transparent),
        radial-gradient(1px 1px at 300px 100px, #FFFFFF, transparent),
        radial-gradient(2px 2px at 400px 50px, #4A90E2, transparent),
        radial-gradient(1px 1px at 500px 150px, #F5A623, transparent),
        radial-gradient(1px 1px at 600px 80px, #FFFFFF, transparent),
        radial-gradient(2px 2px at 700px 120px, #9013FE, transparent),
        linear-gradient(135deg, #0A0E1A 0%, #131B2E 50%, #1A1F36 100%);
      background-repeat: repeat;
      background-size: 800px 200px, 600px 300px, 400px 200px, 500px 250px, 700px 400px, 
                      900px 300px, 1000px 400px, 800px 200px, 600px 300px, 1200px 500px, 100% 100%;
      animation: cosmicDrift 60s linear infinite, twinkle 3s ease-in-out infinite alternate;
    }
    
    @keyframes cosmicDrift {
      0% { transform: translateX(0) translateY(0); }
      100% { transform: translateX(-100px) translateY(-50px); }
    }
    
    @keyframes twinkle {
      0% { opacity: 0.3; }
      100% { opacity: 0.8; }
    }
    
    /* Simplified background - no overwhelming animations */
    .background-gradient {
      position: absolute;
      inset: 0;
      z-index: 1;
      background: 
        linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.02) 50%, transparent 70%),
        radial-gradient(circle at 25% 25%, rgba(102, 126, 234, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(118, 75, 162, 0.06) 0%, transparent 50%);
      animation: gentleShift 20s ease-in-out infinite;
    }
    
    @keyframes gentleShift {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 0.8; }
    }
    
    /* Professional Video Container */
    #videoContainer {
      position: absolute;
      inset: 0;
      z-index: 2;
    }
    
    video { 
      position: absolute; 
      bottom: 120px;
      right: 24px;
      width: 200px; 
      height: 150px; 
      object-fit: cover; 
      transform: scaleX(-1);
      border-radius: var(--radius-xl);
      border: 2px solid var(--border-primary);
      backdrop-filter: blur(20px);
      box-shadow: var(--glass-shadow);
      transition: var(--transition);
      z-index: 10;
      animation: slideInFromRight 0.6s ease-out;
    }
    
    @keyframes slideInFromRight {
      0% {
        opacity: 0;
        transform: scaleX(-1) translateX(50px);
      }
      100% {
        opacity: 1;
        transform: scaleX(-1) translateX(0);
      }
    }
    
    video:hover {
      border-color: var(--primary);
      box-shadow: 0 12px 40px rgba(0, 102, 255, 0.3);
      transform: scaleX(-1) scale(1.02);
    }
    
    canvas { 
      position: absolute; 
      inset: 0; 
      width: 100%; 
      height: 100%; 
      pointer-events: none; 
      z-index: 2;
    }
    
    .video-hidden #video {
      display: none;
    }
    
    /* Modern Professional HUD System */
    .hud {
      position: absolute;
      z-index: 20;
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      background: var(--glass-bg);
      border-radius: var(--radius-xl);
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      transition: var(--transition);
    }
    
    .hud:hover {
      background: var(--bg-card-hover);
      border-color: rgba(255, 255, 255, 0.15);
    }
    
    /* Header */
    .header-hud {
      top: 24px;
      left: 50%;
      transform: translateX(-50%);
      padding: 16px 24px;
      text-align: center;
      max-width: 400px;
    }
    
    /* Status Bar - repositioned to avoid overlap */
    .status-hud {
      top: 24px;
      left: 24px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 0.875rem;
      font-weight: 500;
      font-family: 'JetBrains Mono', monospace;
      max-width: 300px; /* Prevent overlap with video */
    }
    
    /* Settings Modal */
    .settings-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-secondary);
      border-radius: var(--radius-2xl);
      border: 1px solid var(--border-primary);
      box-shadow: var(--shadow-xl);
      padding: 24px;
      z-index: 100;
      min-width: 320px;
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition);
      backdrop-filter: blur(20px);
    }
    
    .settings-modal.show {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }
    
    .settings-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 99;
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition);
    }
    
    .settings-modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }
    
    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-primary);
    }
    
    .settings-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .close-button {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 4px;
      border-radius: var(--radius);
      transition: var(--transition);
    }
    
    .close-button:hover {
      background: var(--glass-bg);
      color: var(--text-primary);
    }
    
    .settings-section {
      margin-bottom: 20px;
    }
    
    .settings-section:last-child {
      margin-bottom: 0;
    }
    
    .section-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 12px;
    }
    
    .setting-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      margin-bottom: 8px;
      transition: var(--transition);
      cursor: pointer;
      position: relative;
    }
    
    .setting-item:hover {
      background: var(--bg-card-hover);
      border-color: var(--primary-light);
    }
    
    .setting-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .setting-icon {
      font-size: 1.2rem;
      width: 24px;
      text-align: center;
    }
    
    .setting-text {
      flex: 1;
    }
    
    .setting-label {
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 2px;
    }
    
    .setting-description {
      font-size: 0.75rem;
      color: var(--text-secondary);
      line-height: 1.3;
    }
    
    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: var(--gray-600);
      border-radius: 12px;
      transition: var(--transition);
      cursor: pointer;
    }
    
    .toggle-switch.active {
      background: var(--primary);
    }
    
    .toggle-switch::before {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: var(--transition);
      transform: translateX(0);
    }
    
    .toggle-switch.active::before {
      transform: translateX(20px);
    }
    
    /* Tooltip */
    .tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--gray-900);
      color: white;
      padding: 8px 12px;
      border-radius: var(--radius);
      font-size: 0.75rem;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
      z-index: 1000;
      margin-bottom: 8px;
    }
    
    .tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 4px solid transparent;
      border-top-color: var(--gray-900);
    }
    
    /* Custom Dropdown Selector */
    .custom-select {
      position: relative;
      min-width: 120px;
    }
    
    .select-button {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      color: var(--text-primary);
      font-size: 0.875rem;
      cursor: pointer;
      transition: var(--transition);
      min-width: 100px;
    }
    
    .select-button:hover {
      background: var(--bg-card-hover);
      border-color: var(--primary-light);
    }
    
    .select-button.active {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(0, 102, 255, 0.2);
    }
    
    .select-arrow {
      font-size: 0.75rem;
      transition: var(--transition);
    }
    
    .select-button.active .select-arrow {
      transform: rotate(180deg);
    }
    
    .select-options {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: var(--transition);
      max-height: 200px;
      overflow-y: auto;
      margin-top: 4px;
    }
    
    .select-options.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .select-option {
      padding: 10px 12px;
      cursor: pointer;
      transition: var(--transition);
      border-bottom: 1px solid var(--border-secondary);
      font-size: 0.875rem;
    }
    
    .select-option:last-child {
      border-bottom: none;
    }
    
    .select-option:hover {
      background: var(--glass-bg);
    }
    
    .select-option.selected {
      background: var(--primary);
      color: white;
    }
    
    .select-option-icon {
      margin-right: 8px;
    }
    
    /* Settings Trigger Button */
    .settings-trigger {
      position: absolute;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      background: var(--primary);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      transition: var(--transition);
      z-index: 20;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .settings-trigger:hover {
      background: var(--primary-dark);
      transform: scale(1.05);
      box-shadow: var(--shadow-xl);
    }
    
    .settings-trigger:active {
      transform: scale(0.95);
    }
    
    /* Professional Typography */
    h1 {
      margin: 0;
      font-size: 1.75rem;
      font-weight: 700;
      letter-spacing: -0.025em;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .logo-icon {
      font-size: 1.5rem;
    }
    
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
      animation: statusPulse 2s ease-in-out infinite;
    }
    
    .status-dot.loading {
      background: var(--warning);
    }
    
    .status-dot.error {
      background: var(--error);
    }
    
    @keyframes statusPulse {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }
    
    /* Professional Instrument Grid */
    .instrument-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .instrument-button {
      padding: 16px 12px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      color: var(--text-primary);
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }
    
    .instrument-button:hover {
      background: var(--bg-card-hover);
      border-color: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    .instrument-button.selected {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-color: var(--primary-light);
      box-shadow: 0 0 0 2px rgba(0, 102, 255, 0.3);
    }
    
    .instrument-button .emoji {
      font-size: 1.5rem;
      margin-bottom: 4px;
    }
    
    .instrument-button .name {
      font-size: 0.75rem;
      font-weight: 500;
      opacity: 0.9;
    }    /* Clean Control Buttons - optimized for new layout */
    .control-btn {
      padding: 10px 16px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      color: var(--text-primary);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      backdrop-filter: blur(16px);
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: flex-start;
      width: 100%;
    }
    
    .control-btn:hover {
      background: var(--bg-card-hover);
      border-color: var(--primary-light);
      transform: translateX(-2px);
    }
    
    .control-btn.active {
      background: var(--primary);
      border-color: var(--primary-light);
      color: white;
    }
    
    .control-btn .icon {
      font-size: 1rem;
      width: 20px;
      text-align: center;
    }
    
    /* Main Instrument Controls - centered and optimized */
        /* Main Controls */
    .controls-hud {
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      padding: 20px 24px;
      min-width: 480px;
      max-width: calc(100vw - 280px); /* Leave space for video controls */
    }
    
    /* Professional Hand Tracking Zones */
    .interaction-zones {
      position: absolute;
      inset: 0;
      z-index: 1;
      pointer-events: none;
    }
    
    .zone {
      position: absolute;
      border-radius: var(--radius-2xl);
      background: var(--glass-bg);
      backdrop-filter: blur(16px) saturate(180%);
      border: 2px solid var(--glass-border);
      transition: var(--transition-slow);
      overflow: hidden;
    }
    
    .zone::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, 
        rgba(255, 255, 255, 0.1) 0%, 
        transparent 70%);
      opacity: 0;
      transition: opacity var(--transition);
    }
    
    .zone.left-zone {
      left: 5%;
      top: 25%;
      width: 25%;
      height: 45%;
      border-color: var(--accent);
      background: linear-gradient(135deg, 
        rgba(16, 185, 129, 0.1) 0%, 
        rgba(16, 185, 129, 0.05) 100%);
    }
    
    .zone.right-zone {
      right: 5%;
      top: 25%;
      width: 25%;
      height: 45%;
      border-color: var(--primary);
      background: linear-gradient(135deg, 
        rgba(0, 102, 255, 0.1) 0%, 
        rgba(0, 102, 255, 0.05) 100%);
    }
    
    .zone.active {
      border-color: rgba(255, 255, 255, 0.6);
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 
        0 0 40px rgba(255, 255, 255, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      transform: scale(1.02);
    }
    
    .zone.active::before {
      opacity: 1;
    }
    
    /* Zone Labels */
    .zone-label {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: var(--text-primary);
      font-weight: 600;
      font-size: 0.875rem;
      text-align: center;
      pointer-events: none;
      background: var(--glass-bg);
      padding: 8px 16px;
      border-radius: var(--radius-lg);
      backdrop-filter: blur(8px);
      border: 1px solid var(--glass-border);
      transition: var(--transition);
    }
    
    .zone.active .zone-label {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
      transform: translateX(-50%) scale(1.05);
    }
    
    .zone-label .emoji {
      font-size: 1.2rem;
      margin-bottom: 4px;
      display: block;
    }
    
    .zone-label .title {
      font-weight: 700;
      font-size: 0.875rem;
    }
    
    .zone-label .subtitle {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-top: 2px;
    }
    
    /* Clean Welcome Modal */
    .welcome-modal {
      position: absolute;
      inset: 0;
      z-index: 50;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 1;
      transition: var(--transition-slow);
    }
    
    .welcome-modal.hidden {
      opacity: 0;
      pointer-events: none;
    }
    
    .welcome-content {
      background: var(--bg-secondary);
      border-radius: var(--radius-2xl);
      border: 1px solid var(--border-primary);
      box-shadow: var(--shadow-xl);
      padding: 32px;
      max-width: 480px;
      text-align: center;
      animation: slideUp 0.5s ease-out;
    }
    
    @keyframes slideUp {
      0% {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .welcome-content h2 {
      margin: 0 0 16px 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .welcome-content p {
      font-size: 1rem;
      line-height: 1.6;
      margin: 12px 0;
      color: var(--text-secondary);
    }
    
    .welcome-content strong {
      color: var(--text-primary);
      font-weight: 600;
    }
    
    .feature-list {
      text-align: left;
      margin: 20px 0;
      padding: 0;
      list-style: none;
    }
    
    .feature-list li {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 8px 0;
      padding: 8px 0;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }
    
    .feature-list .icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      flex-shrink: 0;
    }
    
    .start-button {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-lg);
      padding: 12px 24px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 20px;
    }
    
    .start-button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }
    
    /* Hand Activity Indicators */
    .hand-indicators {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      margin-top: 20px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-secondary);
    }
    
    .hand-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }
    
    .hand-indicator.left {
      color: var(--accent);
    }
    
    .hand-indicator.right {
      color: var(--primary);
    }
    
    .hand-indicator .icon {
      font-size: 1.1rem;
    }
    
    /* Subtle Particle Effects */
    .particles {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 5;
    }
    
    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 50%;
      animation: floatUp 3s ease-out forwards;
    }
    
    @keyframes floatUp {
      0% {
        opacity: 1;
        transform: translateY(0) scale(0);
      }
      50% {
        opacity: 0.8;
        transform: translateY(-50px) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-100px) scale(0.5);
      }
    }
    
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(-20px) scale(0.9); }
      20% { opacity: 1; transform: translateY(0) scale(1); }
      80% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-20px) scale(0.9); }
    }
    
    /* 3D Spatial Music System Styles */
    @keyframes spatialPulse {
      0% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 0.8; }
    }
    
    @keyframes harmonicResonance {
      0% { 
        transform: scale(0.5) rotate(0deg); 
        opacity: 0; 
        filter: hue-rotate(0deg);
      }
      50% { 
        transform: scale(1.5) rotate(180deg); 
        opacity: 1; 
        filter: hue-rotate(90deg);
      }
      100% { 
        transform: scale(2) rotate(360deg); 
        opacity: 0; 
        filter: hue-rotate(180deg);
      }
    }
    
    @keyframes trailFlow {
      0% { 
        opacity: 1; 
        transform: scale(1) translateZ(0px);
        filter: blur(0px);
      }
      100% { 
        opacity: 0; 
        transform: scale(0.3) translateZ(50px);
        filter: blur(3px);
      }
    }
    
    @keyframes zoneActivation {
      0% { 
        opacity: 0.3; 
        transform: scale(0.8);
        filter: brightness(1);
      }
      50% { 
        opacity: 0.8; 
        transform: scale(1.1);
        filter: brightness(1.3);
      }
      100% { 
        opacity: 0.3; 
        transform: scale(0.8);
        filter: brightness(1);
      }
    }
    
    @keyframes depth3D {
      0% { 
        transform: translateZ(0px) scale(1);
        filter: blur(0px) brightness(1);
      }
      50% { 
        transform: translateZ(30px) scale(1.1);
        filter: blur(1px) brightness(1.2);
      }
      100% { 
        transform: translateZ(0px) scale(1);
        filter: blur(0px) brightness(1);
      }
    }
    
    /* 3D Mode specific particles */
    .particle-3d {
      position: absolute;
      pointer-events: none;
      border-radius: 50%;
      animation: depth3D 2s ease-in-out infinite;
      mix-blend-mode: screen;
    }
    
    .particle-trail {
      animation: trailFlow 1.5s ease-out forwards;
    }
    
    .particle-harmony {
      animation: harmonicResonance 3s ease-in-out forwards;
    }
    
    .particle-zone {
      animation: zoneActivation 2s ease-in-out infinite;
    }
    
    /* Enhanced canvas container for 3D effects */
    .canvas-container {
      position: relative;
      perspective: 1000px;
      transform-style: preserve-3d;
    }
    
    .canvas-container canvas {
      backface-visibility: hidden;
      will-change: transform;
    }
    
    /* 3D Mode notification styles */
    .mode-notification {
      animation: fadeInOut 4s ease-in-out forwards;
    }
    
    .style-notification {
      animation: fadeInOut 4s ease-in-out forwards;
    }
    
    /* Responsive Design - Optimized */
    @media (max-width: 768px) {
      .controls-hud {
        min-width: auto;
        max-width: calc(100vw - 48px);
        padding: 16px;
        bottom: 100px; /* Make room for settings button */
      }
      
      .settings-modal {
        min-width: calc(100vw - 40px);
        max-height: 80vh;
        overflow-y: auto;
      }
      
      .settings-trigger {
        width: 48px;
        height: 48px;
        font-size: 1.2rem;
        bottom: 16px;
        right: 16px;
      }
      
      .instrument-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }
      
      .instrument-button {
        padding: 12px 8px;
        font-size: 0.75rem;
      }
      
      .instrument-button .emoji {
        font-size: 1.25rem;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      .welcome-content {
        margin: 20px;
        padding: 24px;
        max-width: calc(100vw - 40px);
      }
      
      .hand-indicators {
        flex-direction: column;
        gap: 12px;
        text-align: center;
      }
      
      video {
        width: 160px;
        height: 120px;
        bottom: 70px;
        right: 16px;
      }
      
      .status-hud {
        left: 16px;
        top: 16px;
        max-width: calc(100vw - 200px);
      }
      
      .zone {
        border-radius: var(--radius-xl);
      }
    }
    
  </style>
</head>
<body>
  <div id="app">
    <div class="cosmic-starfield"></div>
    <div class="background-gradient"></div>
    
    <!-- Welcome Modal -->
    <div class="welcome-modal" id="welcomeModal">
      <div class="welcome-content">
        <h2>
          <span class="logo-icon">🎵</span>
          Air Conductor
        </h2>
        <p>Transform your hands into a <strong>virtual orchestra conductor</strong> and create music through natural gestures.</p>
        
        <ul class="feature-list">
          <li>
            <span class="icon">🖐️</span>
            <span>Use hand movements to control rhythm and melody</span>
          </li>
          <li>
            <span class="icon">🎼</span>
            <span>Choose from multiple instruments and music styles</span>
          </li>
          <li>
            <span class="icon">📏</span>
            <span>Distance-based or gesture-based interaction modes</span>
          </li>
          <li>
            <span class="icon">🎨</span>
            <span>Real-time visual feedback and effects</span>
          </li>
        </ul>
        
        <p><strong>Position yourself 3-4 feet from the camera</strong> for the best experience.</p>
        
        <button class="start-button" onclick="startExperience()">
          Start Conducting
        </button>
      </div>
    </div>
    
    <!-- Hand Tracking Zones -->
    <div class="interaction-zones">
      <div class="zone left-zone" id="leftZone">
        <div class="zone-label">
          <span class="emoji">🥁</span>
          <div class="title">RHYTHM</div>
          <div class="subtitle">Left Hand</div>
        </div>
      </div>
      <div class="zone right-zone" id="rightZone">
        <div class="zone-label">
          <span class="emoji">🎵</span>
          <div class="title">MELODY</div>
          <div class="subtitle">Right Hand</div>
        </div>
      </div>
    </div>
    
    <!-- Settings Modal Overlay -->
    <div class="settings-modal-overlay" id="settingsOverlay"></div>
    
    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
      <div class="settings-header">
        <div class="settings-title">
          <span>⚙️</span>
          Settings
        </div>
        <button class="close-button" id="closeSettings">×</button>
      </div>
      
      <div class="settings-section">
        <div class="section-title">Display Options</div>
        
        <div class="setting-item" data-setting="video">
          <div class="setting-info">
            <div class="setting-icon">📹</div>
            <div class="setting-text">
              <div class="setting-label">Camera Feed</div>
              <div class="setting-description">Show/hide your camera video</div>
            </div>
          </div>
          <div class="toggle-switch active" id="videoToggle"></div>
          <div class="tooltip">Toggle camera visibility</div>
        </div>
        
        <div class="setting-item" data-setting="visual">
          <div class="setting-info">
            <div class="setting-icon">🎨</div>
            <div class="setting-text">
              <div class="setting-label">Visual Mode</div>
              <div class="setting-description">Choose display style</div>
            </div>
          </div>
          <div class="custom-select" id="visualModeSelect">
            <button class="select-button" type="button">
              <span class="select-value">Normal</span>
              <span class="select-arrow">▼</span>
            </button>
            <div class="select-options">
              <div class="select-option selected" data-value="normal">
                <span class="select-option-icon">👁️</span>Normal
              </div>
              <div class="select-option" data-value="abstract">
                <span class="select-option-icon">🎨</span>Abstract
              </div>
              <div class="select-option" data-value="minimal">
                <span class="select-option-icon">◦</span>Minimal
              </div>
            </div>
          </div>
          <div class="tooltip">Choose how hand tracking is displayed</div>
        </div>
      </div>
      
      <div class="settings-section">
        <div class="section-title">Interaction Mode</div>
        
        <div class="setting-item" data-setting="distance">
          <div class="setting-info">
            <div class="setting-icon">📏</div>
            <div class="setting-text">
              <div class="setting-label">Distance Mode</div>
              <div class="setting-description">Use hand zones for control</div>
            </div>
          </div>
          <div class="toggle-switch active" id="distanceMode"></div>
          <div class="tooltip">Switch between distance and gesture modes</div>
        </div>
        
        <div class="setting-item" data-setting="sensitivity">
          <div class="setting-info">
            <div class="setting-icon">🎯</div>
            <div class="setting-text">
              <div class="setting-label">Sensitivity</div>
              <div class="setting-description">Adjust gesture detection sensitivity</div>
            </div>
          </div>
          <div class="toggle-switch" id="sensitivityMode"></div>
          <div class="tooltip">High sensitivity for subtle movements</div>
        </div>
      </div>
      
      
      <div class="settings-section">
        <div class="section-title">Audio Settings</div>
        
        <div class="setting-item" data-setting="volume">
          <div class="setting-info">
            <div class="setting-icon">🔊</div>
            <div class="setting-text">
              <div class="setting-label">Master Volume</div>
              <div class="setting-description">Adjust overall audio level</div>
            </div>
          </div>
          <div class="toggle-switch active" id="volumeMode"></div>
          <div class="tooltip">Toggle audio on/off</div>
        </div>
        
        <div class="setting-item" data-setting="style">
          <div class="setting-info">
            <div class="setting-icon">🎵</div>
            <div class="setting-text">
              <div class="setting-label">Music Style</div>
              <div class="setting-description">Select musical genre</div>
            </div>
          </div>
          <div class="custom-select" id="musicStyleSelect">
            <button class="select-button" type="button">
              <span class="select-value">Pop</span>
              <span class="select-arrow">▼</span>
            </button>
            <div class="select-options">
              <div class="select-option selected" data-value="pop">
                <span class="select-option-icon">🎤</span>Pop
              </div>
              <div class="select-option" data-value="jazz">
                <span class="select-option-icon">🎷</span>Jazz
              </div>
              <div class="select-option" data-value="blues">
                <span class="select-option-icon">🎸</span>Blues
              </div>
              <div class="select-option" data-value="classical">
                <span class="select-option-icon">🎼</span>Classical
              </div>
              <div class="select-option" data-value="rock">
                <span class="select-option-icon">🤘</span>Rock
              </div>
              <div class="select-option" data-value="ambient">
                <span class="select-option-icon">🌊</span>Ambient
              </div>
            </div>
          </div>
          <div class="tooltip">Select the musical genre and style</div>
        </div>
        
        <div class="setting-item" data-setting="engine">
          <div class="setting-info">
            <div class="setting-icon">🎛️</div>
            <div class="setting-text">
              <div class="setting-label">AI Music Engine</div>
              <div class="setting-description">TensorFlow.js powered gesture recognition</div>
            </div>
          </div>
          <div class="custom-select" id="musicEngineSelect">
            <button class="select-button" type="button">
              <span class="select-value">TensorFlow.js</span>
              <span class="select-arrow">▼</span>
            </button>
            <div class="select-options">
              <div class="select-option selected" data-value="tensorflow">
                <span class="select-option-icon">🤖</span>TensorFlow.js (ML)
              </div>
              <div class="select-option" data-value="basic">
                <span class="select-option-icon">🎹</span>Basic (Simple)
              </div>
            </div>
          </div>
          <div class="tooltip">Machine learning powered music generation</div>
        </div>
      </div>
    </div>
    
    <!-- Settings Trigger Button -->
    <button class="settings-trigger" id="settingsTrigger">⚙️</button>
    
    <!-- Video and Tracking -->
    <div id="videoContainer">
      <video id="video" autoplay playsinline></video>
      <canvas id="overlay"></canvas>
      <div class="particles" id="particles"></div>
    </div>
    
    <!-- Header -->
    <div class="hud header-hud">
      <h1>
        <span class="logo-icon">🎵</span>
        Air Conductor
      </h1>
    </div>
    
    <!-- Status - repositioned to avoid overlap -->
    <div class="hud status-hud">
      <div class="status-indicator" id="status">
        <span class="status-dot loading"></span>
        <span>Initializing...</span>
      </div>
    </div>
    
    <!-- Main Instrument Controls - renamed for consistency -->
    <div class="hud instrument-controls">
      <div class="instrument-grid" id="instruments">
        <!-- Populated by JavaScript -->
      </div>
      
      <div class="hand-indicators">
        <div class="hand-indicator left">
          <span class="icon">🖐️</span>
          <strong>Left Hand - Rhythm</strong>
        </div>
        <div class="hand-indicator right">
          <span class="icon">🖐️</span>
          <strong>Right Hand - Melody</strong>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Make Tone.js available globally for the start button
    let Tone;
    
    // Wait for main module to load and provide Tone
    window.addEventListener('load', () => {
      if (window.Tone) {
        Tone = window.Tone;
      } else {
        // Fallback: load Tone.js from CDN
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/tone@15.0.4/build/Tone.js';
        script.onload = () => { Tone = window.Tone; };
        document.head.appendChild(script);
      }
    });
    
    async function startExperience() {
      try {
        // Start Tone.js audio context
        // Wait for Tone to be available
        if (!Tone) {
          // Load Tone.js if not available
          await new Promise(resolve => {
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/tone@15.0.4/build/Tone.js';
            script.onload = () => {
              Tone = window.Tone;
              resolve();
            };
            document.head.appendChild(script);
          });
        }
        
        await Tone.start();
        console.log('🎵 Audio context started!');
        
        document.getElementById('welcomeModal').classList.add('hidden');
        
        // Show success notification
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
          background: rgba(0, 200, 100, 0.9); color: white; padding: 12px 24px;
          border-radius: 8px; z-index: 10000; font-weight: 600;
          animation: fadeInOut 3s ease-in-out forwards;
        `;
        notification.textContent = '🎵 Audio Ready - Start Conducting!';
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
      } catch (error) {
        console.error('Failed to start audio:', error);
        
        // Show error notification
        const errorNotification = document.createElement('div');
        errorNotification.style.cssText = `
          position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
          background: rgba(200, 0, 0, 0.9); color: white; padding: 12px 24px;
          border-radius: 8px; z-index: 10000; font-weight: 600;
          animation: fadeInOut 5s ease-in-out forwards;
        `;
        errorNotification.textContent = '⚠️ Audio initialization failed - Try refreshing the page';
        document.body.appendChild(errorNotification);
        setTimeout(() => errorNotification.remove(), 5000);
        
        // Still hide modal to allow basic functionality
        document.getElementById('welcomeModal').classList.add('hidden');
      }
    }
    
    // Auto-hide welcome modal on any click AND start audio
    document.addEventListener('click', async (e) => {
      if (e.target.closest('.welcome-content')) return;
      
      // Try to start audio context on any user interaction
      try {
        if (window.Tone && window.Tone.context.state !== 'running') {
          await window.Tone.start();
          console.log('🎵 Audio started via user interaction');
        }
      } catch (error) {
        console.log('Audio start attempt:', error);
      }
      
      document.getElementById('welcomeModal').classList.add('hidden');
    });
  </script>
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
